<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc3 {
	color: #FF8000;
}
.sc4 {
	color: #808080;
}
.sc5 {
	font-weight: bold;
	color: #000080;
}
.sc6 {
}
.sc8 {
	font-weight: bold;
	color: #0000FF;
}
.sc9 {
	color: #808000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #800000;
}
.sc13 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">-- ---------------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">-- I2C_controller.vhd</span><span class="sc0">
</span><span class="sc1">-- </span><span class="sc0">
</span><span class="sc1">-- description:</span><span class="sc0">
</span><span class="sc1">-- I2C controller for Altera DE2 board </span><span class="sc0">
</span><span class="sc1">--  for further reading on how this file was implemented please see </span><span class="sc0">
</span><span class="sc1">--  rrespino.com/portfolio.php#embedded i2c Temperature Sensor</span><span class="sc0">
</span><span class="sc1">-- </span><span class="sc0">
</span><span class="sc1">-- PROCESS:</span><span class="sc0">
</span><span class="sc1">-- output</span><span class="sc0">
</span><span class="sc1">-- clockdivider200k</span><span class="sc0">
</span><span class="sc1">-- </span><span class="sc0">
</span><span class="sc1">-- Copywright 2017 &amp;copy; rrespino.com</span><span class="sc0">
</span><span class="sc1">--  All rights reserved  </span><span class="sc0">
</span><span class="sc1">-- =================================================================================</span><span class="sc0">
</span><span class="sc1">-- </span><span class="sc0">
</span><span class="sc1">-- Edits and Profreading done</span><span class="sc0">
</span><span class="sc1">--  by:___________________  Date:__|__|__</span><span class="sc0">
</span><span class="sc1">--    Note:_____________________________________</span><span class="sc0">
</span><span class="sc1">--       rrespino.com            2017</span><span class="sc0">
</span><span class="sc1">--           Cleanup for iframe rendering</span><span class="sc0">
</span><span class="sc1">-- </span><span class="sc0">
</span><span class="sc1">-- ---------------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc8">LIBRARY</span><span class="sc0"> </span><span class="sc12">IEEE</span><span class="sc5">;</span><span class="sc0">
</span><span class="sc8">USE</span><span class="sc0"> </span><span class="sc12">IEEE</span><span class="sc5">.</span><span class="sc12">STD_LOGIC_1164</span><span class="sc5">.</span><span class="sc8">ALL</span><span class="sc5">;</span><span class="sc0">
</span><span class="sc8">USE</span><span class="sc0"> </span><span class="sc12">IEEE</span><span class="sc5">.</span><span class="sc12">STD_LOGIC_UNSIGNED</span><span class="sc5">.</span><span class="sc8">ALL</span><span class="sc5">;</span><span class="sc0">

</span><span class="sc8">ENTITY</span><span class="sc0"> </span><span class="sc6">I2C_controller</span><span class="sc0"> </span><span class="sc8">IS</span><span class="sc0">
</span><span class="sc8">PORT</span><span class="sc0"> </span><span class="sc5">(</span><span class="sc0">
    </span><span class="sc6">CLK_50_MHz</span><span class="sc5">,</span><span class="sc0"> </span><span class="sc6">ResetN</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc8">IN</span><span class="sc0"> </span><span class="sc13">STD_LOGIC</span><span class="sc5">;</span><span class="sc0">
    </span><span class="sc1">--RTC/I2C control signals</span><span class="sc0">
    </span><span class="sc6">SCL</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc8">OUT</span><span class="sc0"> </span><span class="sc13">STD_LOGIC</span><span class="sc5">;</span><span class="sc0">
    </span><span class="sc6">SDA</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc8">INOUT</span><span class="sc0"> </span><span class="sc13">STD_LOGIC</span><span class="sc5">;</span><span class="sc0">
    </span><span class="sc1">--User interface data signals</span><span class="sc0">
    </span><span class="sc6">Read_WriteN</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc8">IN</span><span class="sc0"> </span><span class="sc13">STD_LOGIC</span><span class="sc5">;</span><span class="sc0">
    </span><span class="sc6">DataIn</span><span class="sc5">,</span><span class="sc0"> </span><span class="sc6">AddressIn</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc8">IN</span><span class="sc0"> </span><span class="sc13">STD_LOGIC_VECTOR</span><span class="sc5">(</span><span class="sc3">7</span><span class="sc0"> </span><span class="sc8">DOWNTO</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc5">);</span><span class="sc0">
    </span><span class="sc6">Ack</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc8">OUT</span><span class="sc0"> </span><span class="sc13">STD_LOGIC</span><span class="sc5">;</span><span class="sc0">
    </span><span class="sc6">DataOut</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc8">OUT</span><span class="sc0"> </span><span class="sc13">STD_LOGIC_VECTOR</span><span class="sc5">(</span><span class="sc3">7</span><span class="sc0"> </span><span class="sc8">DOWNTO</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc5">);</span><span class="sc0">
    </span><span class="sc6">StateOut</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc8">OUT</span><span class="sc0"> </span><span class="sc13">STD_LOGIC_VECTOR</span><span class="sc5">(</span><span class="sc3">7</span><span class="sc0"> </span><span class="sc8">DOWNTO</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc5">);</span><span class="sc0">
    </span><span class="sc6">RegisterAddressOut</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc8">OUT</span><span class="sc0"> </span><span class="sc13">STD_LOGIC_VECTOR</span><span class="sc5">(</span><span class="sc3">7</span><span class="sc0"> </span><span class="sc8">DOWNTO</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc5">));</span><span class="sc0">
</span><span class="sc8">END</span><span class="sc0"> </span><span class="sc6">I2C_controller</span><span class="sc5">;</span><span class="sc0">

</span><span class="sc8">ARCHITECTURE</span><span class="sc0"> </span><span class="sc6">FSMD</span><span class="sc0"> </span><span class="sc8">OF</span><span class="sc0"> </span><span class="sc6">I2C_controller</span><span class="sc0"> </span><span class="sc8">IS</span><span class="sc0">
    </span><span class="sc8">SIGNAL</span><span class="sc0"> </span><span class="sc6">state</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc13">STD_LOGIC_VECTOR</span><span class="sc5">(</span><span class="sc3">7</span><span class="sc0"> </span><span class="sc8">DOWNTO</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc5">);</span><span class="sc0">
    </span><span class="sc8">SIGNAL</span><span class="sc0"> </span><span class="sc6">RegisterAddress</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc13">STD_LOGIC_VECTOR</span><span class="sc5">(</span><span class="sc3">7</span><span class="sc0"> </span><span class="sc8">DOWNTO</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc5">);</span><span class="sc0">
    </span><span class="sc8">SIGNAL</span><span class="sc0"> </span><span class="sc6">Data</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc13">STD_LOGIC_VECTOR</span><span class="sc5">(</span><span class="sc3">7</span><span class="sc0"> </span><span class="sc8">DOWNTO</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc5">);</span><span class="sc0">
    </span><span class="sc8">SIGNAL</span><span class="sc0"> </span><span class="sc6">SDA01</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc13">STD_LOGIC</span><span class="sc5">;</span><span class="sc0">    </span><span class="sc1">-- internal SDA having values of 0 and 1</span><span class="sc0">
    
    </span><span class="sc8">SIGNAL</span><span class="sc0"> </span><span class="sc6">bitcount</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc13">INTEGER</span><span class="sc0"> </span><span class="sc8">RANGE</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">TO</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc5">;</span><span class="sc0">
    </span><span class="sc8">CONSTANT</span><span class="sc0"> </span><span class="sc6">SlaveAddress_Read</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc13">STD_LOGIC_VECTOR</span><span class="sc5">(</span><span class="sc3">7</span><span class="sc0"> </span><span class="sc8">DOWNTO</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc5">:=</span><span class="sc0"> </span><span class="sc4">"1101000"</span><span class="sc5">&amp;</span><span class="sc0">'</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">  </span><span class="sc1">-- I2C address of the slave + read</span><span class="sc0">
    </span><span class="sc8">CONSTANT</span><span class="sc0"> </span><span class="sc6">SlaveAddress_Write</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc13">STD_LOGIC_VECTOR</span><span class="sc5">(</span><span class="sc3">7</span><span class="sc0"> </span><span class="sc8">DOWNTO</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc5">:=</span><span class="sc0"> </span><span class="sc4">"1101000"</span><span class="sc5">&amp;</span><span class="sc0">'</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- I2C address of the slave + write'</span><span class="sc0">
    </span><span class="sc8">CONSTANT</span><span class="sc0"> </span><span class="sc6">NumberOfRegisters</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc13">STD_LOGIC_VECTOR</span><span class="sc5">(</span><span class="sc3">7</span><span class="sc0"> </span><span class="sc8">DOWNTO</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc5">:=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"1F"</span><span class="sc5">;</span><span class="sc0">  </span><span class="sc1">-- total number of registers in the slave</span><span class="sc0">
    
    </span><span class="sc1">-- constants for 200kHz clock divider</span><span class="sc0">
    </span><span class="sc8">CONSTANT</span><span class="sc0"> </span><span class="sc6">max200k</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc13">INTEGER</span><span class="sc0"> </span><span class="sc5">:=</span><span class="sc0"> </span><span class="sc3">50000000</span><span class="sc5">/(</span><span class="sc3">100000</span><span class="sc5">*</span><span class="sc3">2</span><span class="sc5">);</span><span class="sc0">   </span><span class="sc1">-- to get 100kHz for I2C standard; every 2 cycles = 1 I2C cycle</span><span class="sc0">
</span><span class="sc1">--  CONSTANT max200k: INTEGER := 50000000/4;    -- for some I2C slaves (Maxim DS1375 RTC) the actual clock speed can be any speed less than the max I2C clock speed</span><span class="sc0">
    </span><span class="sc1">-- some I2C slaves (Maxim DS3232 RTC) requires a minimum SCL rate, so when this clock is too slow, the slave will reset the I2C interface</span><span class="sc0">
    </span><span class="sc8">SIGNAL</span><span class="sc0"> </span><span class="sc6">clockticks200k</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc13">INTEGER</span><span class="sc0"> </span><span class="sc8">RANGE</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">TO</span><span class="sc0"> </span><span class="sc6">max200k</span><span class="sc5">;</span><span class="sc0">
    </span><span class="sc8">SIGNAL</span><span class="sc0"> </span><span class="sc6">CLK_200k_Hz</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc13">STD_LOGIC</span><span class="sc5">;</span><span class="sc0">
    
</span><span class="sc8">BEGIN</span><span class="sc0">

    </span><span class="sc6">StateOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">state</span><span class="sc5">;</span><span class="sc0">
    
    </span><span class="sc1">-- SDA line is open drain that is pulled up with a resistor</span><span class="sc0">
    </span><span class="sc1">-- therefore, to set SDA to a 1 we need to output a Z value</span><span class="sc0">
    </span><span class="sc1">-- SDA is changed only when SCL is low except for sending the start and stop bits</span><span class="sc0">
    </span><span class="sc1">-- i.e. SDA is valid at the rising edge of the SCL (clock)</span><span class="sc0">
    </span><span class="sc6">SDA</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc6">Z</span><span class="sc0">' </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">' </span><span class="sc8">ELSE</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- convert SDA 0/1 to 0/Z</span><span class="sc0">

    </span><span class="sc6">output</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc8">PROCESS</span><span class="sc5">(</span><span class="sc6">CLK_200k_Hz</span><span class="sc5">,</span><span class="sc0"> </span><span class="sc6">ResetN</span><span class="sc5">)</span><span class="sc0">
    </span><span class="sc8">BEGIN</span><span class="sc0">
        </span><span class="sc8">IF</span><span class="sc5">(</span><span class="sc6">ResetN</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc8">THEN</span><span class="sc0">
            </span><span class="sc1">-- when idle, both SDA and SCL = 1</span><span class="sc0">
            </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc6">Ack</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc6">DataOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc4">"00000000"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc6">RegisterAddress</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"FF"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"00"</span><span class="sc5">;</span><span class="sc0">
        </span><span class="sc8">ELSIF</span><span class="sc5">(</span><span class="sc6">CLK_200k_Hz</span><span class="sc0">'</span><span class="sc10">EVENT</span><span class="sc0"> </span><span class="sc9">and</span><span class="sc0"> </span><span class="sc6">CLK_200k_Hz</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc8">THEN</span><span class="sc0">
            </span><span class="sc8">CASE</span><span class="sc0"> </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc8">IS</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"00"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">   </span><span class="sc1">-- Idle</span><span class="sc0">
                </span><span class="sc1">-- when idle, both SDA and SCL = 1</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">     </span><span class="sc1">-- SCL = 1</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- SDA = 1</span><span class="sc0">
                </span><span class="sc6">RegisterAddressOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">RegisterAddress</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">DataOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc4">"00000000"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"01"</span><span class="sc5">;</span><span class="sc0">
                
</span><span class="sc1">----------------------------------------------------------------                </span><span class="sc0">
</span><span class="sc1">-- send start condition and slave address</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"01"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">   </span><span class="sc1">-- Start</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">     </span><span class="sc1">-- SCL stays at 1 while</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- SDA changes from 1 to 0</span><span class="sc0">
                </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc5">;</span><span class="sc0">  </span><span class="sc1">-- starting bit count</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"02"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc1">-- send 7-bit slave address followed by R/W' bit, MSB first</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"02"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">                   
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">SlaveAddress_Write</span><span class="sc5">(</span><span class="sc6">bitcount</span><span class="sc5">);</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"03"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"03"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc5">(</span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">-</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc5">&gt;=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">-</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"02"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"12"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc1">-- get acknowledgment' from slave</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"12"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"13"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"13"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">Ack</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">SDA</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- 0 = acknowledge'; error if it is a 1</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc6">SDA</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">' </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">RegisterAddressOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"13"</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"EE"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- acknowledge error</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"20"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- send register address</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">

</span><span class="sc1">----------------------------------------------------------------</span><span class="sc0">
            </span><span class="sc1">-- send 8-bit register address to slave</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"20"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">AddressIn</span><span class="sc5">(</span><span class="sc6">bitcount</span><span class="sc5">);</span><span class="sc0">   </span><span class="sc1">-- register address MSB first</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"21"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- continue</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"21"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc5">(</span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">-</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc5">&gt;=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">-</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"20"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"30"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc1">-- get acknowledgment'</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"30"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"31"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"31"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">Ack</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">SDA</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- 0 = acknowledge'; error if it is a 1</span><span class="sc0">
                </span><span class="sc6">RegisterAddress</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">AddressIn</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc6">SDA</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">' </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">RegisterAddressOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"31"</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"EE"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- acknowledge error</span><span class="sc0">
                </span><span class="sc8">ELSIF</span><span class="sc0"> </span><span class="sc6">Read_WriteN</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">' </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"40"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- go do a write</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"70"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- send repeated start and then go do a read</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">


</span><span class="sc1">----------------------------------------------------------------                </span><span class="sc0">
</span><span class="sc1">-- going to write data to slave</span><span class="sc0">
            </span><span class="sc1">-- send 8-bit data to slave</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"40"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">DataIn</span><span class="sc5">(</span><span class="sc6">bitcount</span><span class="sc5">);</span><span class="sc0">  </span><span class="sc1">-- Data MSB first</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"41"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"41"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc5">(</span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">-</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc5">&gt;=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">-</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"40"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"50"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc1">-- get acknowledgment'</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"50"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">RegisterAddressOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">AddressIn</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">DataOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">DataIn</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"51"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"51"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">Ack</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">SDA</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- 0 = acknowledge'; error if it is a 1</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc6">SDA</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">' </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">RegisterAddressOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"51"</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"EE"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">    </span><span class="sc1">-- send stop</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"52"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc1">-- send stop</span><span class="sc0">
            </span><span class="sc1">-- SDA goes from 0 to 1 while SCL is 1</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"52"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- SDA starts at 0 to prepare for the 0 to 1 transition</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"53"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"53"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">     </span><span class="sc1">-- SCL goes to 1</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- SDA starts from 0</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"54"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"54"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">   </span><span class="sc1">-- idle state</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">     </span><span class="sc1">-- SCL stays at 1 while</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- SDA goes to 1</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"54"</span><span class="sc5">;</span><span class="sc0">


</span><span class="sc1">----------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">----------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">-- going to receive data from slave</span><span class="sc0">
            </span><span class="sc1">-- send repeated start condition to do a read after a write</span><span class="sc0">
            </span><span class="sc1">-- SDA goes from 1 to 0 while SCL is 1</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"70"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- SDA starts at 1 to prepare for the 1 to 0 transition</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc6">SDA</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">' </span><span class="sc8">THEN</span><span class="sc0">   </span><span class="sc1">-- SDA is still a 0 here from acknowledgement</span><span class="sc0">
                    </span><span class="sc6">RegisterAddressOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"70"</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"EE"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- acknowledge error</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"71"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- continue</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"71"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">   </span><span class="sc1">-- idle state with both SCL and SDA at 1</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">     </span><span class="sc1">-- SCL goes to 1</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- SDA starts from 1</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"72"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"72"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">   </span><span class="sc1">-- Start</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">     </span><span class="sc1">-- SCL stays at 1 while</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- SDA changes from 1 to 0</span><span class="sc0">
                </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"82"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc1">-- send 7-bit slave address followed by R/W' bit, MSB first</span><span class="sc0">
            </span><span class="sc1">-- slave address for RTC chip is 1101000</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"82"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">                   
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">SlaveAddress_Read</span><span class="sc5">(</span><span class="sc6">bitcount</span><span class="sc5">);</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"83"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"83"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc5">(</span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">-</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc5">&gt;=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">-</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"82"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"92"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc1">-- get acknowledgment' from slave</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"92"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"93"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"93"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">Ack</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">SDA</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- 0 = acknowledge'; error if it is a 1</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc6">SDA</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">' </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">RegisterAddressOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"93"</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"EE"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- acknowledge error</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"C0"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- go to receive data byte</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">


</span><span class="sc1">----------------------------------------------------------------</span><span class="sc0">
            </span><span class="sc1">-- receive bytes from RTC</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"C0"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"C1"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"C1"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">Data</span><span class="sc5">(</span><span class="sc6">bitcount</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">SDA</span><span class="sc5">;</span><span class="sc0">  </span><span class="sc1">-- MSB of data read in</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc5">(</span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">-</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc5">&gt;=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">-</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"C0"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D0"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc1">-- if more bytes to read then send an acknowledge' (0) signal</span><span class="sc0">
            </span><span class="sc1">-- if no more bytes to read then send a not acknowledge' (1) signal</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D0"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc5">(</span><span class="sc6">RegisterAddress</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> </span><span class="sc6">RegisterAddress</span><span class="sc5">)</span><span class="sc0"> </span><span class="sc8">THEN</span><span class="sc0">         </span><span class="sc1">-- read only one byte</span><span class="sc0">
</span><span class="sc1">--              IF (RegisterAddress + 1 &gt; NumberOfRegisters) THEN   -- read multi-bytes</span><span class="sc0">
                    </span><span class="sc1">-- read last byte</span><span class="sc0">
                    </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- send a not acknowledge' (1) signal</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D2"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- stop reading</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc1">-- read next byte</span><span class="sc0">
                    </span><span class="sc6">RegisterAddress</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">RegisterAddress</span><span class="sc0"> </span><span class="sc5">+</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">;</span><span class="sc0">
                    </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- send an acknowledge' (0) signal</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D1"</span><span class="sc5">;</span><span class="sc0"> </span><span class="sc1">-- continue to read next byte from slave-transmitter</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">RegisterAddressOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">RegisterAddress</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">DataOut</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">Data</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D1"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"C0"</span><span class="sc5">;</span><span class="sc0">

            </span><span class="sc1">-----------------------------------------------------------</span><span class="sc0">
            </span><span class="sc1">-- send a not acknowledge' (1) signal</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D2"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D3"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc1">-- send stop condition</span><span class="sc0">
            </span><span class="sc1">-- SDA goes from 0 to 1 while SCL is 1</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D3"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- SDA starts at 0 to prepare for the 0 to 1 transition</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D4"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D4"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">     </span><span class="sc1">-- SCL goes to 1</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- SDA starts from 0</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D5"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D5"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">     </span><span class="sc1">-- SCL stays at 1 while</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">   </span><span class="sc1">-- SDA goes to 1</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"D5"</span><span class="sc5">;</span><span class="sc0">


</span><span class="sc1">-----------------------------------------------------------</span><span class="sc0">
            </span><span class="sc1">-- error - did not recieve the acknowledge</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"EE"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc1">--gets here only if ack is error</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"EE"</span><span class="sc5">;</span><span class="sc0">


</span><span class="sc1">-----------------------------------------------------------</span><span class="sc0">
            </span><span class="sc1">-- wait for the I2C to be idle by waiting for the SDA to be high for at least 8 SCL cycles</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"F0"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"F1"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"F1"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc6">SDA</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">' </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">-</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"F2"</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"F2"</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc6">bitcount</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">THEN</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"00"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">ELSE</span><span class="sc0">
                    </span><span class="sc6">state</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">x</span><span class="sc4">"F1"</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
                
            </span><span class="sc8">WHEN</span><span class="sc0"> </span><span class="sc8">OTHERS</span><span class="sc0"> </span><span class="sc5">=&gt;</span><span class="sc0"> </span><span class="sc8">null</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SCL</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
                </span><span class="sc6">SDA01</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
            </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">CASE</span><span class="sc5">;</span><span class="sc0">
        </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
    </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">PROCESS</span><span class="sc5">;</span><span class="sc0">

    </span><span class="sc6">clockdivider200k</span><span class="sc5">:</span><span class="sc0"> </span><span class="sc8">PROCESS</span><span class="sc0">
    </span><span class="sc8">BEGIN</span><span class="sc0">
        </span><span class="sc8">WAIT</span><span class="sc0"> </span><span class="sc8">UNTIL</span><span class="sc0"> </span><span class="sc6">CLK_50_MHz</span><span class="sc0">'</span><span class="sc10">EVENT</span><span class="sc0"> </span><span class="sc9">and</span><span class="sc0"> </span><span class="sc6">CLK_50_MHz</span><span class="sc0"> </span><span class="sc5">=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
        </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc6">clockticks200k</span><span class="sc0"> </span><span class="sc5">&lt;</span><span class="sc0"> </span><span class="sc6">max200k</span><span class="sc0"> </span><span class="sc8">THEN</span><span class="sc0">
            </span><span class="sc6">clockticks200k</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc6">clockticks200k</span><span class="sc0"> </span><span class="sc5">+</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc5">;</span><span class="sc0">
        </span><span class="sc8">ELSE</span><span class="sc0">
            </span><span class="sc6">clockticks200k</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc5">;</span><span class="sc0">
        </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
        </span><span class="sc8">IF</span><span class="sc0"> </span><span class="sc6">clockticks200k</span><span class="sc0"> </span><span class="sc5">&lt;</span><span class="sc0"> </span><span class="sc6">max200k</span><span class="sc5">/</span><span class="sc3">2</span><span class="sc0"> </span><span class="sc8">THEN</span><span class="sc0">
            </span><span class="sc6">CLK_200k_Hz</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">0</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
        </span><span class="sc8">ELSE</span><span class="sc0">
            </span><span class="sc6">CLK_200k_Hz</span><span class="sc0"> </span><span class="sc5">&lt;=</span><span class="sc0"> '</span><span class="sc3">1</span><span class="sc0">'</span><span class="sc5">;</span><span class="sc0">
        </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">IF</span><span class="sc5">;</span><span class="sc0">
    </span><span class="sc8">END</span><span class="sc0"> </span><span class="sc8">PROCESS</span><span class="sc5">;</span><span class="sc0">

</span><span class="sc8">END</span><span class="sc0"> </span><span class="sc6">FSMD</span><span class="sc5">;</span><span class="sc0">
</span></div></body>
</html>
